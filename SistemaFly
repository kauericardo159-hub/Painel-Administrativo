-- Nome: Fly_Elite_V4
local player = game.Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")

-- Espera o painel principal
local MainGui = pGui:WaitForChild("MainControlPanel", 15)
local Scroll = MainGui.MainFrame:WaitForChild("ButtonList")

-- Variáveis de Controle
local flying = false
local flySpeed = 16
local bodyVelocity, bodyGyro

-- Criar Container do Botão (Layout Horizontal)
local Container = Instance.new("Frame")
Container.Name = "Fly_Container"
Container.Parent = Scroll
Container.Size = UDim2.new(1, 0, 0, 50)
Container.BackgroundTransparency = 1

local UIList = Instance.new("UIListLayout", Container)
UIList.FillDirection = Enum.FillDirection.Horizontal
UIList.Padding = UDim.new(0, 10)
UIList.VerticalAlignment = Enum.VerticalAlignment.Center

-- 1. Campo de Velocidade (Input)
local SpeedInput = Instance.new("TextBox")
SpeedInput.Name = "SpeedInput"
SpeedInput.Parent = Container
SpeedInput.Size = UDim2.new(0, 120, 0, 40)
SpeedInput.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
SpeedInput.Text = "Vel. 16"
SpeedInput.PlaceholderText = "Vel."
SpeedInput.TextColor3 = Color3.new(1, 1, 1)
SpeedInput.Font = Enum.Font.GothamBold
SpeedInput.TextSize = 14

local SpeedCorner = Instance.new("UICorner", SpeedInput)
local SpeedStroke = Instance.new("UIStroke", SpeedInput)
SpeedStroke.Color = Color3.fromRGB(0, 170, 255)
SpeedStroke.Thickness = 2

-- 2. Botão Ativar/Desativar
local ActionBtn = Instance.new("TextButton")
ActionBtn.Name = "ActionBtn"
ActionBtn.Parent = Container
ActionBtn.Size = UDim2.new(0, 200, 0, 40)
ActionBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ActionBtn.Text = "ATIVAR | INATIVO"
ActionBtn.TextColor3 = Color3.new(1, 1, 1)
ActionBtn.Font = Enum.Font.GothamBold
ActionBtn.TextSize = 14

local ActionCorner = Instance.new("UICorner", ActionBtn)
local ActionStroke = Instance.new("UIStroke", ActionBtn)
ActionStroke.Color = Color3.fromRGB(255, 255, 255)
ActionStroke.Thickness = 2

-- Animação do UIStroke (Arco-íris suave)
task.spawn(function()
    local h = 0
    while true do
        h = h + 1/360
        ActionStroke.Color = Color3.fromHSV(h % 1, 0.8, 1)
        SpeedStroke.Color = Color3.fromHSV(h % 1, 0.8, 1)
        task.wait()
    end
end)

-- Lógica de Mudança de Velocidade
SpeedInput.FocusLost:Connect(function()
    local val = string.match(SpeedInput.Text, "%d+")
    if val then
        flySpeed = tonumber(val)
        SpeedInput.Text = "Vel. " .. val
    else
        SpeedInput.Text = "Vel. " .. flySpeed
    end
end)

-- Lógica do Movimento (Analógico & Mobile Friendly)
local function startFlying()
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:WaitForChild("HumanoidRootPart")
    local hum = char:WaitForChild("Humanoid")
    local camera = workspace.CurrentCamera

    bodyGyro = Instance.new("BodyGyro", root)
    bodyGyro.P = 9e4
    bodyGyro.maxTorque = Vector3.new(9e4, 9e4, 9e4)
    
    bodyVelocity = Instance.new("BodyVelocity", root)
    bodyVelocity.velocity = Vector3.new(0, 0, 0)
    bodyVelocity.maxForce = Vector3.new(9e4, 9e4, 9e4)

    hum.PlatformStand = true

    task.spawn(function()
        while flying do
            -- Captura a direção do movimento (Funciona com Analógico e WASD)
            local moveDir = hum.MoveDirection
            
            if moveDir.Magnitude > 0 then
                -- Se estiver se movendo, usa a direção do analógico/teclado
                bodyVelocity.velocity = moveDir * flySpeed
            else
                -- Se parado, mantém no lugar
                bodyVelocity.velocity = Vector3.new(0, 0, 0)
            end
            
            -- Faz o personagem olhar para onde a câmera aponta
            bodyGyro.cframe = camera.CFrame
            RunService.RenderStepped:Wait()
        end
    end)
end

ActionBtn.MouseButton1Click:Connect(function()
    flying = not flying
    if flying then
        ActionBtn.Text = "ATIVAR | ATIVO"
        ActionBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        startFlying()
    else
        ActionBtn.Text = "ATIVAR | INATIVO"
        ActionBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        if bodyGyro then bodyGyro:Destroy() end
        if bodyVelocity then bodyVelocity:Destroy() end
        if player.Character then
            player.Character.Humanoid.PlatformStand = false
        end
    end
end)
