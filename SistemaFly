--[[ 
    FLY CONTROL V6 - REFEITO DO ZERO
    Focado em Mobile, Movimentação 3D por Câmera e Injeção Automática
]]

local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- 1. LOCALIZAÇÃO E INJEÇÃO NO PAINEL V6
local pGui = player:WaitForChild("PlayerGui")
local mainGui = pGui:WaitForChild("MainControlPanel", 15)
local scroll = mainGui.MainFrame:WaitForChild("ButtonList")

-- 2. VARIÁVEIS DE CONTROLE DE VOO
local flying = false
local flySpeed = 50
local bv = nil -- BodyVelocity
local bg = nil -- BodyGyro

-- --- FUNÇÃO DE NOTIFICAÇÃO LUXUOSA ---
local function Notify(title, text, color)
    local notifyFrame = Instance.new("Frame")
    notifyFrame.Size = UDim2.new(0, 240, 0, 75)
    notifyFrame.Position = UDim2.new(0.5, -120, -0.3, 0)
    notifyFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
    notifyFrame.Parent = mainGui
    notifyFrame.ZIndex = 100
    
    local corner = Instance.new("UICorner", notifyFrame)
    corner.CornerRadius = UDim.new(0, 12)
    
    local stroke = Instance.new("UIStroke", notifyFrame)
    stroke.Color = color
    stroke.Thickness = 2
    
    local content = Instance.new("TextLabel", notifyFrame)
    content.Size = UDim2.new(1, -20, 1, -10)
    content.Position = UDim2.new(0, 10, 0, 5)
    content.BackgroundTransparency = 1
    content.Text = "<b>" .. title .. "</b>\n" .. text
    content.TextColor3 = Color3.new(1,1,1)
    content.Font = Enum.Font.GothamBold
    content.TextSize = 14
    content.RichText = true

    notifyFrame:TweenPosition(UDim2.new(0.5, -120, 0.05, 0), "Out", "Back", 0.5)
    task.delay(2.5, function()
        notifyFrame:TweenPosition(UDim2.new(0.5, -120, -0.3, 0), "In", "Quad", 0.5)
        task.wait(0.6)
        notifyFrame:Destroy()
    end)
end

-- --- ESTRUTURA VISUAL DO BOTÃO NO SCROLL ---
local Container = Instance.new("Frame")
Container.Name = "Fly_Control_Entry"
Container.Parent = scroll
Container.Size = UDim2.new(0.95, 0, 0, 55)
Container.BackgroundTransparency = 1

local UIList = Instance.new("UIListLayout", Container)
UIList.FillDirection = Enum.FillDirection.Horizontal
UIList.Padding = UDim.new(0, 10)
UIList.VerticalAlignment = Enum.VerticalAlignment.Center

-- Input de Velocidade (TextBox Estiloso)
local SpeedInput = Instance.new("TextBox")
SpeedInput.Size = UDim2.new(0, 85, 0, 42)
SpeedInput.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
SpeedInput.Text = "50"
SpeedInput.PlaceholderText = "Vel."
SpeedInput.TextColor3 = Color3.fromRGB(0, 255, 255)
SpeedInput.Font = Enum.Font.GothamBold
SpeedInput.TextSize = 16
Instance.new("UICorner", SpeedInput).CornerRadius = UDim.new(0, 8)
local sStroke = Instance.new("UIStroke", SpeedInput)
sStroke.Color = Color3.fromRGB(60, 60, 80)

-- Botão de Toggle principal
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(1, -95, 0, 42)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
ToggleBtn.Text = "1 | FLY CONTROL: OFF"
ToggleBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 14
Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(0, 8)

-- --- MOTOR DE VOO (PROGRAMAÇÃO REFEITA) ---
local function startFlight()
    character = player.Character
    local root = character:FindFirstChild("HumanoidRootPart")
    local hum = character:FindFirstChild("Humanoid")
    
    if not root or not hum then return end
    
    -- Configuração Física do Fly
    bg = Instance.new("BodyGyro")
    bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
    bg.P = 15000 -- Suavidade de rotação
    bg.cframe = root.CFrame
    bg.Parent = root
    
    bv = Instance.new("BodyVelocity")
    bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
    bv.velocity = Vector3.new(0, 0.1, 0)
    bv.Parent = root
    
    hum.PlatformStand = true -- Desativa animações de queda
    
    task.spawn(function()
        while flying and character.Parent do
            local moveDirection = hum.MoveDirection -- Lê o analógico do Mobile / Teclado
            
            if moveDirection.Magnitude > 0 then
                -- O SEGREDO: Multiplicar a direção do movimento pela CFrame da Câmera
                -- Isso permite subir se olhar para cima e descer se olhar para baixo
                local direction = (camera.CFrame:VectorToWorldSpace(Vector3.new(moveDirection.X, 0, moveDirection.Z * -1)))
                bv.velocity = direction * flySpeed
            else
                -- Flutuação estática (anti-gravidade)
                bv.velocity = Vector3.new(0, 0.1, 0)
            end
            
            -- O personagem sempre olha para onde a câmera aponta
            bg.cframe = camera.CFrame
            RunService.RenderStepped:Wait()
        end
        
        -- Limpeza ao desativar
        if bv then bv:Destroy() end
        if bg then bg:Destroy() end
        if hum then hum.PlatformStand = false end
    end)
end

-- --- LÓGICA DE ATIVAÇÃO ---
ToggleBtn.MouseButton1Click:Connect(function()
    flying = not flying
    flySpeed = tonumber(SpeedInput.Text) or 50
    
    if flying then
        ToggleBtn.Text = "1 | FLY CONTROL: ON"
        ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(0, 150, 255)}):Play()
        Notify("FLY ACTIVATED", "Direção baseada na câmera\nVelocidade: " .. flySpeed, Color3.fromRGB(0, 200, 255))
        startFlight()
    else
        ToggleBtn.Text = "1 | FLY CONTROL: OFF"
        ToggleBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
        TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}):Play()
        Notify("FLY DEACTIVATED", "Retornando à física normal", Color3.fromRGB(255, 80, 80))
    end
end)
