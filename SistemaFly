-- Fly Control V6 - Refeito do Zero
local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local runService = game:GetService("RunService")
local tweenService = game:GetService("TweenService")

-- 1. LOCALIZAR O PAINEL (V6)
local pGui = player:WaitForChild("PlayerGui")
local mainGui = pGui:WaitForChild("MainControlPanel", 15)
local scroll = mainGui.MainFrame:WaitForChild("ButtonList")

-- 2. VARIÁVEIS DE ESTADO E CONFIGURAÇÃO
local flying = false
local speed = 50
local bv, bg -- BodyVelocity e BodyGyro

-- --- NOTIFICAÇÃO LUXUOSA ---
local function showNotify(title, text, color)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 220, 0, 60)
    frame.Position = UDim2.new(0.5, -110, -0.2, 0)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    frame.Parent = mainGui
    frame.ZIndex = 10
    
    local corner = Instance.new("UICorner", frame)
    local stroke = Instance.new("UIStroke", frame)
    stroke.Color = color
    stroke.Thickness = 2
    
    local txt = Instance.new("TextLabel", frame)
    txt.Size = UDim2.new(1, 0, 1, 0)
    txt.BackgroundTransparency = 1
    txt.Text = "<b>" .. title .. "</b>\n" .. text
    txt.TextColor3 = Color3.new(1,1,1)
    txt.Font = Enum.Font.GothamBold
    txt.TextSize = 13
    txt.RichText = true

    frame:TweenPosition(UDim2.new(0.5, -110, 0.05, 0), "Out", "Back", 0.5)
    task.delay(2.5, function()
        frame:TweenPosition(UDim2.new(0.5, -110, -0.2, 0), "In", "Quad", 0.5)
        task.wait(0.5)
        frame:Destroy()
    end)
end

-- --- ESTRUTURA DO BOTÃO ---
local FlyFrame = Instance.new("Frame")
FlyFrame.Name = "FlyControl_Entry"
FlyFrame.Parent = scroll
FlyFrame.Size = UDim2.new(0.95, 0, 0, 55)
FlyFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
FlyFrame.BackgroundTransparency = 0.5
Instance.new("UICorner", FlyFrame).CornerRadius = UDim.new(0, 10)

local UIList = Instance.new("UIListLayout", FlyFrame)
UIList.FillDirection = Enum.FillDirection.Horizontal
UIList.Padding = UDim.new(0, 10)
UIList.VerticalAlignment = Enum.VerticalAlignment.Center
UIList.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- Input de Velocidade (Value)
local SpeedBox = Instance.new("TextBox")
SpeedBox.Size = UDim2.new(0, 70, 0, 35)
SpeedBox.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
SpeedBox.Text = "50"
SpeedBox.TextColor3 = Color3.fromRGB(0, 255, 200)
SpeedBox.Font = Enum.Font.GothamBold
SpeedBox.TextSize = 15
Instance.new("UICorner", SpeedBox)
Instance.new("UIStroke", SpeedBox).Color = Color3.fromRGB(60, 60, 70)

-- Botão de Toggle
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(0, 250, 0, 35)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(50, 20, 20)
ToggleBtn.Text = "FLY CONTROL: INATIVO"
ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 13
Instance.new("UICorner", ToggleBtn)

-- --- LÓGICA DE MOVIMENTAÇÃO ---
local function startFlying()
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    bg = Instance.new("BodyGyro", char.HumanoidRootPart)
    bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
    bg.P = 15000
    
    bv = Instance.new("BodyVelocity", char.HumanoidRootPart)
    bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
    bv.velocity = Vector3.new(0, 0, 0)
    
    char.Humanoid.PlatformStand = true
    
    task.spawn(function()
        while flying and char and char:FindFirstChild("HumanoidRootPart") do
            local moveDir = char.Humanoid.MoveDirection -- Analógico Mobile
            
            if moveDir.Magnitude > 0 then
                -- O segredo do Fly: Mover para onde a Câmera aponta (3D)
                local cameraCFrame = camera.CFrame
                local look = cameraCFrame.LookVector
                local right = cameraCFrame.RightVector
                
                -- Se empurrar pra frente, usa o LookVector (sobe/desce com a câmera)
                -- Se empurrar pro lado, usa o RightVector
                local direction = (look * (moveDir.Z * -1)) + (right * moveDir.X)
                bv.velocity = direction.Unit * speed
            else
                bv.velocity = Vector3.new(0, 0.1, 0) -- Hover
            end
            
            bg.cframe = camera.CFrame
            runService.RenderStepped:Wait()
        end
        
        -- Limpeza ao desligar
        if bg then bg:Destroy() end
        if bv then bv:Destroy() end
        if char:FindFirstChild("Humanoid") then
            char.Humanoid.PlatformStand = false
        end
    end)
end

-- --- EVENTOS ---
ToggleBtn.MouseButton1Click:Connect(function()
    flying = not flying
    speed = tonumber(SpeedBox.Text) or 50
    
    if flying then
        ToggleBtn.Text = "FLY CONTROL: ATIVO"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
        showNotify("FLY SYSTEM", "Controle 3D Ativado\nVelocidade: "..speed, Color3.fromRGB(0, 255, 150))
        startFlying()
    else
        ToggleBtn.Text = "FLY CONTROL: INATIVO"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(50, 20, 20)
        showNotify("FLY SYSTEM", "Modo Caminhada", Color3.fromRGB(255, 50, 50))
    end
end)
